{% extends 'admin/dashboard.html' %}
{% load static %}

{% block extra_head %}
<!-- Flatpickr -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/l10n/fr.js"></script>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto mt-12 mb-16">
  <div class="relative overflow-hidden">
    <div class="absolute -top-10 -left-10 w-40 h-40 bg-blue-500 rounded-full opacity-10"></div>
    <div class="absolute -bottom-10 -right-10 w-60 h-60 bg-purple-500 rounded-full opacity-10"></div>
    
    <!-- Carte principale avec effet de verre -->

    <div class="relative backdrop-blur-sm bg-white/90 rounded-2xl shadow-xl border border-gray-200 overflow-hidden">
      <div class="bg-gradient-to-r from-blue-600 to-purple-600 px-8 py-6 flex items-center">
        <div class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center mr-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            {% if form.instance.pk %}
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            {% else %}
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            {% endif %}
          </svg>
        </div>
        <h1 class="text-3xl font-bold text-white">
          {% if form.instance.pk %}Modifier l'événement{% else %}Créer un nouvel événement{% endif %}
        </h1>
      </div>

      <div class="p-8">
        <div class="mb-8 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-md">
          <p class="text-lg text-gray-700">
            {% if form.instance.pk %}
            Vous modifiez l'événement « {{ form.instance.titre }} ».
            {% else %}
            Complétez le formulaire ci-dessous pour créer un nouvel événement.
            {% endif %}
          </p>
        </div>

        <form method="post" enctype="multipart/form-data" novalidate class="space-y-8">
          {% csrf_token %}

          <!-- Titre -->
          <div class="space-y-2">
            <label for="{{ form.titre.id_for_label }}" class="block text-xl font-medium text-gray-800">Titre *</label>
            {{ form.titre }}
            {% if form.titre.help_text %}<p class="mt-1 text-sm text-gray-500">{{ form.titre.help_text }}</p>{% endif %}
            {% if form.titre.errors %}<p class="mt-1 text-sm text-red-600">{{ form.titre.errors.0 }}</p>{% endif %}
          </div>

          <!-- Slug -->
          <div class="space-y-2">
            <label for="{{ form.slug.id_for_label }}" class="block text-xl font-medium text-gray-800">URL (slug)</label>
            {{ form.slug }}
            <p class="mt-1 text-sm text-gray-500">Laisser vide pour générer automatiquement depuis le titre.</p>
            {% if form.slug.errors %}<p class="mt-1 text-sm text-red-600">{{ form.slug.errors.0 }}</p>{% endif %}
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Date début -->
            <div class="space-y-2">
              <label for="{{ form.date_debut.id_for_label }}" class="block text-sm font-medium text-gray-800">Date de début *</label>
              {{ form.date_debut }}
              {% if form.date_debut.help_text %}<p class="mt-1 text-sm text-gray-500">{{ form.date_debut.help_text }}</p>{% endif %}
              {% if form.date_debut.errors %}<p class="mt-1 text-sm text-red-600">{{ form.date_debut.errors.0 }}</p>{% endif %}
            </div>

            <!-- Date fin -->
            <div class="space-y-2">
              <label for="{{ form.date_fin.id_for_label }}" class="block text-sm font-medium text-gray-800">Date de fin *</label>
              {{ form.date_fin }}
              {% if form.date_fin.help_text %}<p class="mt-1 text-sm text-gray-500">{{ form.date_fin.help_text }}</p>{% endif %}
              {% if form.date_fin.errors %}<p class="mt-1 text-sm text-red-600">{{ form.date_fin.errors.0 }}</p>{% endif %}
            </div>

            <!-- Lieu -->
            <div class="col-span-2 md:col-span-1 space-y-2">
              <label for="{{ form.lieu.id_for_label }}" class="block text-sm font-medium text-gray-800">Lieu</label>
              {{ form.lieu }}
              {% if form.lieu.help_text %}<p class="mt-1 text-sm text-gray-500">{{ form.lieu.help_text }}</p>{% endif %}
              {% if form.lieu.errors %}<p class="mt-1 text-sm text-red-600">{{ form.lieu.errors.0 }}</p>{% endif %}
            </div>
          </div>

          <!-- Image -->

          <div class="space-y-2">
            <label for="{{ form.image.id_for_label }}" class="block text-xl font-medium text-gray-800">
              Image principale
            </label>
            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg">
              <div class="space-y-1 text-center w-full">
                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                  <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <div class="flex text-sm text-gray-600 justify-center">
                  <label for="{{ form.image.id_for_label }}" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500">
                    <span>Télécharger une image</span>
                    {{ form.image }}
                  </label>
                </div>
                <p class="text-xs text-gray-500">PNG, JPG, GIF jusqu'à 10MB</p>
              </div>

              {% if form.image.help_text %}
              <p class="mt-1 text-sm text-gray-500">{{ form.image.help_text }}</p>
              {% endif %}
              {% if form.image.errors %}
              <p class="mt-1 text-sm text-red-600">{{ form.image.errors }}</p>
              {% endif %}
              {% if form.instance.image %}
              <div class="mt-2">
                <p class="text-sm text-gray-500">Image actuelle :</p>
                <div class="mt-1">
                  <img src="{{ form.instance.image.url }}" class="h-32 rounded-md" alt="Image actuelle">
                </div>
              </div>
              {% endif %}
            </div>

            {% if form.image.errors %}<p class="mt-1 text-sm text-red-600">{{ form.image.errors.0 }}</p>{% endif %}
            {% if form.image.help_text %}<p class="mt-1 text-sm text-gray-500">{{ form.image.help_text }}</p>{% endif %}
          </div>

          <!-- Description -->
          <div class="space-y-2">
            <label for="{{ form.description.id_for_label }}" class="block text-xl font-medium text-gray-800">Description *</label>
            {{ form.description }}
            {% if form.description.help_text %}<p class="mt-1 text-sm text-gray-500">{{ form.description.help_text }}</p>{% endif %}
            {% if form.description.errors %}<p class="mt-1 text-sm text-red-600">{{ form.description.errors.0 }}</p>{% endif %}
          </div>

          <div class="pt-8 border-t border-gray-200 flex flex-col sm:flex-row justify-between items-center gap-4">
            <a href="{% url 'evenements_list' %}" class="w-full sm:w-auto inline-flex justify-center items-center px-6 py-3 border border-gray-300 shadow-sm text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
              </svg>
              Annuler
            </a>

            <button type="submit" class="w-full sm:w-auto inline-flex justify-center items-center px-6 py-3 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              {% if form.instance.pk %}Mettre à jour{% else %}Publier l'événement{% endif %}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Conseils -->
  <div class="mt-8 p-6 bg-white rounded-xl shadow-md border border-gray-100">
    <h3 class="font-bold text-xl text-gray-800 mb-4">Conseils</h3>
    <ul class="list-disc ml-6 text-gray-700 space-y-2">
      <li>Choisissez un titre clair et précis</li>
      <li>Définissez correctement les dates (début / fin)</li>
      <li>Ajoutez une image illustrative de bonne qualité</li>
      <li>Relisez la description avant publication</li>
    </ul>
  </div>
</div>

<!-- Scripts: classes, flatpickr, preview -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Ajout de classes génériques aux inputs / textarea / select
    document.querySelectorAll('input[type="text"], input[type="email"], input[type="datetime-local"], input[type="date"], input[type="url"], input[type="number"]').forEach(function(el) {
      el.classList.add('mt-1', 'block', 'w-full', 'rounded-md', 'border-gray-300', 'shadow-sm', 'focus:border-blue-500', 'focus:ring', 'focus:ring-blue-500', 'focus:ring-opacity-50', 'text-lg', 'px-3', 'py-2');
    });
    document.querySelectorAll('textarea').forEach(function(el) {
      el.classList.add('mt-1', 'block', 'w-full', 'rounded-md', 'border-gray-300', 'shadow-sm', 'focus:border-blue-500', 'focus:ring', 'focus:ring-blue-500', 'focus:ring-opacity-50', 'text-lg', 'px-3', 'py-2');
      // si tu veux plus grand
      if (!el.rows || el.rows < 6) el.rows = 8;
    });
    document.querySelectorAll('select').forEach(function(el) {
      el.classList.add('mt-1', 'block', 'w-full', 'rounded-md', 'border-gray-300', 'shadow-sm', 'focus:border-blue-500', 'focus:ring', 'focus:ring-blue-500', 'focus:ring-opacity-50', 'text-lg', 'px-3', 'py-2');
    });
    // Initialiser flatpickr sur les inputs datetime-local (ou ajouter la classe datepicker si nécessaire)
    document.querySelectorAll('input[type="datetime-local"], input[type="date"]').forEach(function(el) {
      el.classList.add('datepicker');
    });
    if (typeof flatpickr !== 'undefined') {
      flatpickr('.datepicker', {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        locale: "fr",
        time_24hr: true,
        allowInput: true
      });
    }
  });
</script>
{% endblock %}